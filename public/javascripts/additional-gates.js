joint.shapes.logic.InputLow = joint.shapes.logic.IO.extend({

    defaults: joint.util.deepSupplement({

        type: 'logic.InputLow',
        attrs: {
            '.wire': { 'ref-dx': 0, d: 'M 0 0 L 23 0' },
            circle: { ref: '.body', 'ref-dx': 30, 'ref-y': 0.5, magnet: true, 'class': 'output', port: 'out' },
            text: { text: 'low' }
        }

    }, joint.shapes.logic.IO.prototype.defaults)
});

joint.shapes.logic.Gate31 = joint.shapes.logic.Gate.extend({

    markup: '<g class="rotatable"><g class="scalable"><image class="body"/></g><circle class="input input1"/><circle  class="input input2"/><circle  class="input input3"/><circle class="output"/></g>',

    defaults: joint.util.deepSupplement({

        type: 'logic.Gate31',
        attrs: {
            '.input1': { ref: '.body', 'ref-x': -2, 'ref-y': 0.3, magnet: 'passive', port: 'in1' },
            '.input2': { ref: '.body', 'ref-x': -2, 'ref-y': 0.7, magnet: 'passive', port: 'in2' },
            '.input3': { ref: '.body', 'ref-x': 47, 'ref-dy': 5.0, magnet: 'passive', port: 'in3' },
            '.output': { ref: '.body', 'ref-dx': 2, 'ref-y': 0.5, magnet: true, port: 'out' }
        }

    }, joint.shapes.logic.Gate.prototype.defaults)

});

// D Flip-flop
joint.shapes.logic.Dff = joint.shapes.logic.Gate11.extend({

    defaults: joint.util.deepSupplement({

        type: 'logic.Dff',
        attrs: { image: { 'xlink:href': 'data:image/png;base64,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' }}

    }, joint.shapes.logic.Gate11.prototype.defaults),
    
    initialize: function() {
        var self = this;
        self.outQ = undefined;
        self.clk = 0;
        self.reset = function() {
            // console.log('reseting dff');
            self.outQ = undefined;
            self.clk = 0;
            // console.log(self);
        }
        self.nextTimeStep = function(graph) {
            var wireIn = graph.getConnectedLinks(self, { inbound: true });
            if (wireIn.length > 0) {
                var inD = wireIn[0].get('signal'); // current input signal
                if (self.clk === 0) {
                    self.clk = 1;
                    self.outQ = (inD === 1) ? true : false;
                } else {
                    self.clk = 0;
                }
            }
        }
        self.operation = function(input) {
            return self.outQ;
        }
        joint.shapes.logic.Gate11.prototype.initialize.apply(this, arguments);
    }
});


joint.shapes.logic.Mux21 = joint.shapes.logic.Gate31.extend({

    defaults: joint.util.deepSupplement({

        type: 'logic.Mux21',
        attrs: { image: { 'xlink:href': 'data:image/png;base64,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' }}

    }, joint.shapes.logic.Gate31.prototype.defaults),

    operation: function(input1, input2, input3) {
        // Assuming all inputs are connected to wire (no unconnected port)
        if (input3 === undefined) return false;
        if (input3) 
            return input2;
        else 
            return input1;
    }

});

joint.shapes.logic.Mux21_16 = joint.shapes.logic.Gate31.extend({

    defaults: joint.util.deepSupplement({

        type: 'logic.Mux21_16',
        attrs: { image: { 'xlink:href': 'data:image/png;base64,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' }}

    }, joint.shapes.logic.Gate31.prototype.defaults),
    
    portList: {
        'in1': { label: 'A', type: 'logic.Bus'},
        'in2': { label: 'B', type: 'logic.Bus'},
        'in3': { label: 'sel', type: 'logic.Bus'},
        'out': { label: 'Q', type: 'logic.Bus'}
    },

    operation: function(input1, input2, input3) {
        // Assuming all inputs are connected to wire (no unconnected port)
        // TO DO: update logic function here
        if (input3 === undefined) return false;
        if (input3) 
            return input2;
        else 
            return input1;
    }

});

// Bus connection
joint.shapes.logic.Bus = joint.dia.Link.extend({

    arrowheadMarkup: [
        '<g class="marker-arrowhead-group marker-arrowhead-group-<%= end %>">',
        '<circle class="marker-arrowhead" end="<%= end %>" r="7"/>',
        '</g>'
    ].join(''),

    vertexMarkup: [
        '<g class="marker-vertex-group" transform="translate(<%= x %>, <%= y %>)">',
        '<circle class="marker-vertex" idx="<%= idx %>" r="10" />',
        '<g class="marker-vertex-remove-group">',
        '<path class="marker-vertex-remove-area" idx="<%= idx %>" d="M16,5.333c-7.732,0-14,4.701-14,10.5c0,1.982,0.741,3.833,2.016,5.414L2,25.667l5.613-1.441c2.339,1.317,5.237,2.107,8.387,2.107c7.732,0,14-4.701,14-10.5C30,10.034,23.732,5.333,16,5.333z" transform="translate(5, -33)"/>',
        '<path class="marker-vertex-remove" idx="<%= idx %>" transform="scale(.8) translate(9.5, -37)" d="M24.778,21.419 19.276,15.917 24.777,10.415 21.949,7.585 16.447,13.087 10.945,7.585 8.117,10.415 13.618,15.917 8.116,21.419 10.946,24.248 16.447,18.746 21.948,24.248z">',
        '<title>Remove vertex.</title>',
        '</path>',
        '</g>',
        '</g>'
    ].join(''),

    defaults: joint.util.deepSupplement({
        type: 'logic.Bus',
        attrs: {
            '.connection': { 'stroke-width': 6 },
            '.marker-vertex': { r: 7 }
        },
        router: { name: 'orthogonal' },
        connector: { name: 'rounded', args: { radius: 10 }}
    }, joint.dia.Link.prototype.defaults)

});

// Joiner
joint.shapes.logic.Joiner = joint.shapes.logic.Gate11.extend({

    defaults: joint.util.deepSupplement({

        type: 'logic.Joiner',
        attrs: { image: { 'xlink:href': 'data:image/png;base64,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' }}

    }, joint.shapes.logic.Gate11.prototype.defaults),
    
    portList: {
        'in': { label: 'in', type: 'logic.Wire'},
        'out': { label: 'out', type: 'logic.Bus'}
    }

});

// Splitter
joint.shapes.logic.Splitter = joint.shapes.logic.Gate11.extend({

    defaults: joint.util.deepSupplement({

        type: 'logic.Splitter',
        attrs: { image: { 'xlink:href': 'data:image/png;base64,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' }}

    }, joint.shapes.logic.Gate11.prototype.defaults),

    portList: {
        'in': { label: 'in', type: 'logic.Bus'},
        'out': { label: 'out', type: 'logic.Wire'}
    }

});


// State Machine Controller
joint.shapes.logic.SMC = joint.shapes.basic.Generic.extend({
    markup: '<g class="rotatable"><g class="scalable"><rect class="smc"/></g><text/><circle class="input"/><circle class="output"/></g>',

    defaults: joint.util.deepSupplement({

        type: 'logic.SMC',
        attrs: {
            rect: { fill: 'white', rx: 2, ry: 2, stroke: 'black', 'stroke-width': 1.5, 'follow-scale': true, width: 80, height: 40 },
            text: {
                text: 'SMC', 'font-size': 16, 'ref-x': .5, 'ref-y': .5, ref: 'rect', 'y-alignment': 'middle', 'x-alignment': 'middle'
            },
            '.smc': { width: 100, height: 50 },
            circle: { r: 7, stroke: 'black', fill: 'white', 'stroke-width': 2 },
            '.input': { ref: '.smc', 'ref-x': -0, 'ref-y': 0.5, magnet: 'passive', port: 'in' },  // contains state number (first 5 bits)
            '.output': { ref: '.smc', 'ref-dx': 0, 'ref-y': 0.5, magnet: true, port: 'out' }
        }

    }, joint.shapes.logic.Gate.prototype.defaults),

    portList: {
        'in': { label: 'din', type: 'logic.Bus'},
        'out': { label: 'dout', type: 'logic.Bus'}
    },
    
    outputsList: function() {
        return ['PC_sel', 'PC_we', 'INST_we', 'REG_sel', 'REG_we', 'OFF_we', 'OFF_sel', 'REG2_we', 'RF_sel', 'RF_we', 'VAL1_we', 'VAL2_we', 'VAL2_sel', 'ADDR_we', 'A_sel', 'B_sel', 'ALU_op', 'RAM_we', 'SREG_we', 'VAL_sel', 'VAL_we' ];
    }
});


// Registers
joint.shapes.logic.Register = joint.shapes.basic.Generic.extend({
    markup: '<g class="rotatable"><g class="scalable"><rect class="reg"/></g><text/><circle class="input1"/><circle class="input2"/><circle class="output"/></g>',

    defaults: joint.util.deepSupplement({

        type: 'logic.Register',
        attrs: {
            rect: { fill: 'white', rx: 2, ry: 2, stroke: 'black', 'stroke-width': 1.5, 'follow-scale': true, width: 80, height: 40 },
            text: {
                text: 'REG', 'font-size': 16, 'ref-x': .5, 'ref-y': .5, ref: 'rect', 'y-alignment': 'middle', 'x-alignment': 'middle'
            },
            '.reg': { width: 100, height: 50 },
            circle: { r: 7, stroke: 'black', fill: 'white', 'stroke-width': 2 },
            '.input1': { ref: '.reg', 'ref-x': 0, 'ref-y': 0.3, magnet: 'passive', port: 'in1' },  // for d-in
            '.input2': { ref: '.reg', 'ref-x': 0, 'ref-y': 0.7, magnet: 'passive', port: 'in2' },  // for write-enable
            '.output': { ref: '.reg', 'ref-dx': 0, 'ref-y': 0.5, magnet: true, port: 'out' }
        }

    }, joint.shapes.logic.Gate.prototype.defaults),

    portList: {
        'in1': { label: 'din', type: 'logic.Bus'},
        'in2': { label: 'we', type: 'logic.Wire'},
        'out': { label: 'dout', type: 'logic.Bus'}
    },

    initialize: function() {
        var self = this;
        self.outQ = undefined;
        self.clk = 0;
        self.reset = function() {
            // console.log('reseting reg');
            self.outQ = undefined;
            self.clk = 0;
            // console.log(self);
        }
        self.nextTimeStep = function(graph) {
            var dIn,we;
            graph.getConnectedLinks(self, {inbound: true}).forEach(function(link) {
                if (link.attributes.target.port === 'in1') dIn = link;
                else if (link.attributes.target.port === 'in2') we = link;
            });
            if (dIn === undefined || we === undefined) return;
            if (self.clk === 0) {
                if (we.get('signal') === 1) {
                    self.outQ = dIn.get('busSignal');
                }
            } else {
                self.clk = 0;
            }
        }
        self.operation = function() {
            return self.outQ;
        }
        // Resize
        this.set({ size: { width: 80, height: 50 } } );
        joint.shapes.basic.Generic.prototype.initialize.apply(this, arguments);
    }
});


joint.shapes.logic.ALU = joint.shapes.basic.Generic.extend({
    markup: '<g class="rotatable"><g class="scalable"><rect class="alu"/></g><text/><circle class="input1"/><circle class="input2"/><circle class="input3"/><circle class="input4"/><circle class="output1"/><circle class="output2"/></g>',

    defaults: joint.util.deepSupplement({

        type: 'logic.ALU',
        attrs: {
            rect: { fill: 'white', rx: 2, ry: 2, stroke: 'black', 'stroke-width': 1.5, 'follow-scale': true, width: 80, height: 40 },
            text: {
                text: 'ALU', 'font-size': 16, 'ref-x': .5, 'ref-y': .5, ref: 'rect', 'y-alignment': 'middle', 'x-alignment': 'middle'
            },
            '.alu': { width: 100, height: 50 },
            circle: { r: 7, stroke: 'black', fill: 'white', 'stroke-width': 2 },
            '.input1': { ref: '.alu', 'ref-x': 0, 'ref-y': 0.2, magnet: 'passive', port: 'in1' },  // 
            '.input2': { ref: '.alu', 'ref-x': 0, 'ref-y': 0.4, magnet: 'passive', port: 'in2' },  // 
            '.input3': { ref: '.alu', 'ref-x': 0, 'ref-y': 0.6, magnet: 'passive', port: 'in3' },  // 
            '.input4': { ref: '.alu', 'ref-x': 0, 'ref-y': 0.8, magnet: 'passive', port: 'in4' },  // 
            '.output1': { ref: '.alu', 'ref-dx': 0, 'ref-y': 0.3, magnet: true, port: 'out1' },
            '.output2': { ref: '.alu', 'ref-dx': 0, 'ref-y': 0.7, magnet: true, port: 'out2' }
        }

    }, joint.shapes.logic.Gate.prototype.defaults),

    portList: {
        'in1': { label: 'A', type: 'logic.Bus'},
        'in2': { label: 'B', type: 'logic.Bus'},
        'in3': { label: 'sreg_in', type: 'logic.Bus'},
        'in4': { label: 'op', type: 'logic.Wire'},
        'out1': { label: 'Q', type: 'logic.Bus'},
        'out2': { label: 'sreg_out', type: 'logic.Bus'}
    },

    initialize: function() {
        // Resize
        this.set({ size: { width: 80, height: 120 } } );
        joint.shapes.basic.Generic.prototype.initialize.apply(this, arguments);
    }
});

// PM: 1 in 1 out
joint.shapes.logic.PM = joint.shapes.basic.Generic.extend({
    markup: '<g class="rotatable"><g class="scalable"><rect class="pm"/></g><text/><circle class="input"/><circle class="output"/></g>',

    defaults: joint.util.deepSupplement({

        type: 'logic.PM',
        attrs: {
            rect: { fill: 'white', rx: 2, ry: 2, stroke: 'black', 'stroke-width': 1.5, 'follow-scale': true, width: 80, height: 40 },
            text: {
                text: 'PM', 'font-size': 16, 'ref-x': .5, 'ref-y': .5, ref: 'rect', 'y-alignment': 'middle', 'x-alignment': 'middle'
            },
            '.pm': { width: 100, height: 50 },
            circle: { r: 7, stroke: 'black', fill: 'white', 'stroke-width': 2 },
            '.input': { ref: '.pm', 'ref-x': 0, 'ref-y': 0.5, magnet: 'passive', port: 'in' },  // 
            '.output': { ref: '.pm', 'ref-dx': 0, 'ref-y': 0.5, magnet: true, port: 'out' }
        }

    }, joint.shapes.logic.Gate.prototype.defaults),

    portList: {
        'in': { label: 'addr', type: 'logic.Bus'},
        'out': { label: 'dout', type: 'logic.Bus'}
    },

    initialize: function() {
        // Resize
        // this.set({ size: { width: 80, height: 90 } } );
        joint.shapes.basic.Generic.prototype.initialize.apply(this, arguments);
    }
});


// RF: 3 in 2 out
joint.shapes.logic.RF = joint.shapes.basic.Generic.extend({
    markup: '<g class="rotatable"><g class="scalable"><rect class="rf"/></g><text/><circle class="input1"/><circle class="input2"/><circle class="input3"/><circle class="output1"/><circle class="output2"/></g>',

    defaults: joint.util.deepSupplement({

        type: 'logic.RF',
        attrs: {
            rect: { fill: 'white', rx: 2, ry: 2, stroke: 'black', 'stroke-width': 1.5, 'follow-scale': true, width: 80, height: 40 },
            text: {
                text: 'RF', 'font-size': 16, 'ref-x': .5, 'ref-y': .5, ref: 'rect', 'y-alignment': 'middle', 'x-alignment': 'middle'
            },
            '.rf': { width: 100, height: 50 },
            circle: { r: 7, stroke: 'black', fill: 'white', 'stroke-width': 2 },
            '.input1': { ref: '.rf', 'ref-x': 0, 'ref-y': 0.25, magnet: 'passive', port: 'in1' },  // 
            '.input2': { ref: '.rf', 'ref-x': 0, 'ref-y': 0.5, magnet: 'passive', port: 'in2' },  // 
            '.input3': { ref: '.rf', 'ref-x': 0, 'ref-y': 0.75, magnet: 'passive', port: 'in3' },  // 
            '.output1': { ref: '.rf', 'ref-dx': 0, 'ref-y': 0.3, magnet: true, port: 'out1' },
            '.output2': { ref: '.rf', 'ref-dx': 0, 'ref-y': 0.7, magnet: true, port: 'out2' }
        }

    }, joint.shapes.logic.Gate.prototype.defaults),

    portList: {
        'in1': { label: 'addr', type: 'logic.Bus'},
        'in2': { label: 'din', type: 'logic.Bus'},
        'in3': { label: 'we', type: 'logic.Wire'},
        'out1': { label: 'dout', type: 'logic.Bus'},
        'out2': { label: 'x', type: 'logic.Bus'}
    },

    initialize: function() {
        // Resize
        this.set({ size: { width: 80, height: 80 } } );
        joint.shapes.basic.Generic.prototype.initialize.apply(this, arguments);
    }
});

// RAM: 3 in 1 out
joint.shapes.logic.RAM = joint.shapes.basic.Generic.extend({
    markup: '<g class="rotatable"><g class="scalable"><rect class="ram"/></g><text/><circle class="input1"/><circle class="input2"/><circle class="input3"/><circle class="output"/></g>',

    defaults: joint.util.deepSupplement({

        type: 'logic.RAM',
        attrs: {
            rect: { fill: 'white', rx: 2, ry: 2, stroke: 'black', 'stroke-width': 1.5, 'follow-scale': true, width: 80, height: 40 },
            text: {
                text: 'RAM', 'font-size': 16, 'ref-x': .5, 'ref-y': .5, ref: 'rect', 'y-alignment': 'middle', 'x-alignment': 'middle'
            },
            '.ram': { width: 100, height: 50 },
            circle: { r: 7, stroke: 'black', fill: 'white', 'stroke-width': 2 },
            '.input1': { ref: '.ram', 'ref-x': 0, 'ref-y': 0.25, magnet: 'passive', port: 'in1' },  // 
            '.input2': { ref: '.ram', 'ref-x': 0, 'ref-y': 0.5, magnet: 'passive', port: 'in2' },  // 
            '.input3': { ref: '.ram', 'ref-x': 0, 'ref-y': 0.75, magnet: 'passive', port: 'in3' },  // 
            '.output': { ref: '.ram', 'ref-dx': 0, 'ref-y': 0.5, magnet: true, port: 'out' }
        }

    }, joint.shapes.logic.Gate.prototype.defaults),
    
    portList: {
        'in1': { label: 'addr', type: 'logic.Bus'},
        'in2': { label: 'din', type: 'logic.Bus'},
        'in3': { label: 'we', type: 'logic.Wire'},
        'out': { label: 'dout', type: 'logic.Bus'}
    },

    initialize: function() {
        // Resize
        this.set({ size: { width: 80, height: 80 } } );
        joint.shapes.basic.Generic.prototype.initialize.apply(this, arguments);
    }
});


